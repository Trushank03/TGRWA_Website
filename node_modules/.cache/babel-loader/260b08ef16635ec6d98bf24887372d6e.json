{"ast":null,"code":"import _slicedToArray from\"/home/bibhu/CelpipSoftware/celpipSW/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect,useRef}from'react';import classes from'./WritingTest.module.css';import{TextAreaInput}from'../CommonApps/FormInputObjects';import Countdown from'react-countdown';import{BsStopwatch}from'react-icons/bs';import{FaMicrophoneAlt}from'react-icons/fa';import{addspeakingtaskresponse}from'../CommonApps/AllAPICalls';//import { createFFmpeg, fetchFile } from '@ffmpeg/ffmpeg';\n//import { fetchFile } from '@ffmpeg/ffmpeg';\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OneSpeakingTask=function OneSpeakingTask(props){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selectedAudioFile=_useState2[0],setSelectedAudioFile=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),mediaRecorder=_useState4[0],setMediaRecorder=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),audioChunks=_useState6[0],setAudioChunks=_useState6[1];var startRecording=function startRecording(){navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){var recorder=new MediaRecorder(stream);setMediaRecorder(recorder);var chunks=[];recorder.addEventListener(\"dataavailable\",function(event){chunks.push(event.data);});recorder.addEventListener(\"stop\",function(){var audioBlob=new Blob(chunks,{type:'audio/mpeg-3'});console.log(\"audoBlob\",audioBlob);var responseId=props.responseId;var speakingTaskId=props.OneTask.id;var formData=new FormData();formData.append('audioFile',audioBlob,'audio.mp3');//formData.append('audioFile', selectedAudioFile.image[0]);\nformData.append('speakingTaskId',speakingTaskId);addspeakingtaskresponse({responseId:responseId,formData:formData,props:props});var audioUrl=URL.createObjectURL(audioBlob);var downloadLink=document.createElement('a');downloadLink.href=audioUrl;downloadLink.download='audio.mp3';document.body.appendChild(downloadLink);//console.log(\"downloaded link: \", downloadLink);\ndownloadLink.click();document.body.removeChild(downloadLink);setAudioChunks([]);setMediaRecorder(null);});recorder.start();});};var handleChangeAudioFile=function handleChangeAudioFile(e){if(e.target&&e.target.files[0]){if(e.target.name==='audioFile'){setSelectedAudioFile({image:e.target.files});}}};var stopRecording=function stopRecording(){mediaRecorder.stop();};var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),rerender=_useState8[0],setRerender=_useState8[1];//  useEffect(()=>{\n//   console.log(\"recording started\");\n//startRecording();\n// },[rerender]);\nvar RerenderHandler=function RerenderHandler(){setRerender(function(rerender){return!rerender;});};console.log(\"audioChunks:::::::::;: \",audioChunks);var handleChange=function handleChange(){};var renderer=function renderer(_ref){var hours=_ref.hours,minutes=_ref.minutes,seconds=_ref.seconds,completed=_ref.completed;if(completed){// Render a completed state\nreturn/*#__PURE__*/_jsx(\"div\",{children:\" Over \"});}else{// Render a countdown\nif(minutes===0){return/*#__PURE__*/_jsxs(\"span\",{style:{color:\"red\",paddingLeft:\"10px\",paddingRight:\"10px\"},children:[\" \",/*#__PURE__*/_jsxs(\"b\",{children:[\" \",minutes,\":\",seconds]}),\" mins\"]});}else{return/*#__PURE__*/_jsxs(\"span\",{children:[\" \",minutes,\":\",seconds,\" mins \"]});}}};var prep_time=Date.now()+Number(props.OneTask!==null?props.OneTask.preparation_time:0)*60*1000;var record_time=Date.now()+Number(props.OneTask!==null?props.OneTask.recording_time:0)*60*1000;var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),recordTimer=_useState10[0],setRecordTimer=_useState10[1];useEffect(function(){setRecordTimer(false);},[props.OneTask.id]);var moveToRecordCountHandler=function moveToRecordCountHandler(){setRecordTimer(true);startRecording();};var nextSecHandler=function nextSecHandler(){if(!recordTimer){setRecordTimer(true);startRecording();}if(recordTimer){stopRecording();props.nextSecHandler();}};return/*#__PURE__*/_jsxs(\"div\",{className:classes.oneWritingTask,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.writingTitle,children:[/*#__PURE__*/_jsxs(\"span\",{children:[\" \",/*#__PURE__*/_jsxs(\"b\",{children:[\" \",props.OneTask.title,\" \"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{children:[\" Preparartion Time : \",props.OneTask.preparation_time,\" mins \"]}),/*#__PURE__*/_jsxs(\"span\",{style:{marginLeft:\"20px\"},children:[\" Recording Time : \",props.OneTask.recording_time,\" mins \"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:classes.nextSectionButton,onClick:nextSecHandler,children:\" NEXT \"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.textQuestionBoxes,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.textQuestionBoxLeft,style:{width:\"100%\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.audioSpeakerBox,children:[!recordTimer&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{marginRight:\"10px\"},children:\" Preparation time \"}),/*#__PURE__*/_jsx(BsStopwatch,{}),/*#__PURE__*/_jsx(Countdown,{date:prep_time,renderer:renderer,onComplete:moveToRecordCountHandler},props.OneTask.id)]}),recordTimer&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{marginRight:\"10px\"},children:\" Speak now \"}),/*#__PURE__*/_jsx(FaMicrophoneAlt,{}),/*#__PURE__*/_jsx(Countdown,{date:record_time,renderer:renderer,onComplete:nextSecHandler},props.OneTask.id)]})]}),/*#__PURE__*/_jsx(\"div\",{style:{color:\"var(--themeColor)\",marginBottom:\"20px\",marginTop:\"30px\"},children:/*#__PURE__*/_jsxs(\"b\",{children:[\" \",props.OneTask.questionText]})}),props.OneTask.imageFile!==null&&/*#__PURE__*/_jsx(\"img\",{className:classes.userImage,src:props.OneTask.imageFile,alt:\"edr Logo\"})]})})]});};export default OneSpeakingTask;","map":null,"metadata":{},"sourceType":"module"}